<!DOCTYPE html>
<html>
<head>
    <title>DevOps Slot Machine</title>
    <style>
        body {
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #0f0f0f, #1e1e1e);
            font-family: Arial, sans-serif;
            color: white;
        }

        .card {
            background: #1a1a1a;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            width: 520px;
            box-shadow: 0 0 25px rgba(0, 255, 150, 0.3);
        }

        #reels {
            font-size: 42px;
            margin: 20px 0;
        }

        button {
            background: #00ff99;
            border: none;
            padding: 12px 25px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
        }

        button:hover {
            background: #00cc77;
        }

        .reset-btn {
            background: #444;
        }

        .reset-btn:hover {
            background: #666;
        }

        #balance {
            margin-top: 15px;
            font-size: 18px;
        }

        /* ===== NEW STATS UI ===== */

        .stats-container {
            margin-top: 25px;
            background: #111;
            padding: 20px;
            border-radius: 12px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: #1f1f1f;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #00ff99;
        }

        .history {
            text-align: left;
            max-height: 120px;
            overflow-y: auto;
            background: #1f1f1f;
            padding: 10px;
            border-radius: 8px;
        }

        .history-item {
            margin-bottom: 6px;
            font-size: 14px;
        }
        #reels {
    font-size: 65px;
    letter-spacing: 15px;
    margin: 30px 0;
}

.spinning {
    animation: spinMotion 0.15s linear infinite;
}

@keyframes spinMotion {
    0%   { transform: translateY(0px); }
    25%  { transform: translateY(-10px); }
    50%  { transform: translateY(10px); }
    75%  { transform: translateY(-10px); }
    100% { transform: translateY(0px); }
}
    </style>
</head>
<body>

<div class="card">
    <h1>ğŸ° DevOps Slot Machine</h1>

    <div id="reels">ğŸ² ğŸ² ğŸ²</div>

    <button onclick="spin()">ğŸ¯ SPIN</button>
    <button class="reset-btn" onclick="resetGame()">ğŸ”„ RESET</button>

    <div id="balance">ğŸ’° Balance: $100</div>
    <div id="message"></div>

    <div class="stats-container">
        <div class="stats-grid" id="statsGrid"></div>

        <h3 style="margin-bottom:8px;">ğŸ•’ Last 5 Spins</h3>
        <div class="history" id="history"></div>
    </div>
</div>

<script>

const symbolMap = {
    "@": "ğŸ’",
    "#": "ğŸ’",
    "$": "ğŸ’°",
    "*": "â­",
    "7": "7ï¸âƒ£",
    "BAR": "ğŸŸ¥",
    "CHERRY": "ğŸ’",
    "LEMON": "ğŸ‹"
};

function animateReels() {
    const reels = document.getElementById("reels");
    reels.classList.add("spinning");

    let symbols = Object.values(symbolMap);

    let interval = setInterval(() => {
        reels.innerHTML =
            `${symbols[Math.floor(Math.random()*symbols.length)]}
             ${symbols[Math.floor(Math.random()*symbols.length)]}
             ${symbols[Math.floor(Math.random()*symbols.length)]}`;
    }, 100);

    return interval;
}

async function spin() {

    const reels = document.getElementById("reels");

    reels.classList.add("spinning");

    let symbols = Object.values(symbolMap);

    const interval = setInterval(() => {
        reels.innerHTML =
            `${symbols[Math.floor(Math.random()*symbols.length)]}
             ${symbols[Math.floor(Math.random()*symbols.length)]}
             ${symbols[Math.floor(Math.random()*symbols.length)]}`;
    }, 100);

    const response = await fetch('/spin', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ bet_amount: 5 })
    });

    const data = await response.json();

    // Force minimum spin duration
    await new Promise(resolve => setTimeout(resolve, 1000));

    clearInterval(interval);
    reels.classList.remove("spinning");

    if (!response.ok) {
        document.getElementById('message').innerHTML =
            `âš  ${data.detail}`;
        return;
    }

    reels.innerHTML =
        `${symbolMap[data.reel1]} 
         ${symbolMap[data.reel2]} 
         ${symbolMap[data.reel3]}`;

    document.getElementById('balance').innerHTML =
        `ğŸ’° Balance: $${data.new_balance}`;

    document.getElementById('message').innerHTML =
        data.winnings > 0
            ? `ğŸ‰ JACKPOT! You won $${data.winnings}!`
            : `ğŸ˜… No win.`;

    loadStats();
}


async function loadStats() {
    const response = await fetch('/stats');
    const data = await response.json();

    document.getElementById('statsGrid').innerHTML = `
        <div class="stat-box">ğŸ“Š Spins<div class="stat-value">${data.total_spins}</div></div>
        <div class="stat-box">ğŸ† Wins<div class="stat-value">${data.total_wins}</div></div>
        <div class="stat-box">ğŸ’ Total Won<div class="stat-value">$${data.total_amount_won}</div></div>
        <div class="stat-box">ğŸ“ˆ Win Rate<div class="stat-value">${data.win_rate}%</div></div>
        <div class="stat-box">ğŸ”¥ Highest Win<div class="stat-value">$${data.highest_win}</div></div>
        <div class="stat-box">ğŸš€ Win Streak<div class="stat-value">${data.max_win_streak}</div></div>
    `;

    let historyHTML = data.last_5_spins.map(spin =>
        `<div class="history-item">
            ğŸ² ${spin.reels.map(r => symbolMap[r]).join(" | ")}
            â†’ ğŸ’° $${spin.winnings}
        </div>`
    ).join("");

    document.getElementById('history').innerHTML = historyHTML;
}

async function resetGame() {
    await fetch('/reset', { method: 'POST' });

    document.getElementById('reels').innerHTML = "ğŸ² ğŸ² ğŸ²";
    document.getElementById('balance').innerHTML = "ğŸ’° Balance: $100";
    document.getElementById('message').innerHTML = "";

    loadStats();
}

loadStats();

</script>

</body>
</html>